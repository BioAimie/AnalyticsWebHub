SELECT 
	ISNULL([SalesOrder], 'NoSO') AS [SalesOrder],
	[ItemID],
	[WhseID],
	[ProductType],
	ISNULL([CustID], 'IDATEC') AS [CustID],
	[CustClass], 
	ISNULL([State],'BFDx') AS [State],
	ISNULL([Country],'BFDx') AS [Country],
	[SalesSource],
	[SalesTerritoryID],
	[SOUnitPrice],
	[OrderStatus],
	[ShipDate],
	IIF([TranType] LIKE 'SH', [ItemsShipped], -1*[ItemsShipped]) AS [ItemsShipped],
	IIF([TranType] LIKE 'SH', [QtyShipped], -1*[QtyShipped]) AS [QtyShipped] 
FROM
(
	SELECT 
		ISNULL(S.[SalesOrder], I.[SalesOrder]) AS [SalesOrder],
		ISNULL(S.[ItemID], I.[ItemID]) AS [ItemID],
		ISNULL(S.[WhseID], I.[WhseID]) AS [WhseID],
		ISNULL(S.[ProductType], I.[ProductType]) AS [ProductType],
		ISNULL(S.[CustID], I.[CustID]) AS [CustID],
		ISNULL(S.[CurrentCustClassID], I.[CurrentCustClassID]) AS [CustClass],
		ISNULL(S.[ShipToAddrStateID], I.[ShipToAddrStateID]) AS [State],
		ISNULL(S.[ShipToCountryID], I.[ShipToCountryID]) AS [Country],
		ISNULL(S.[SalesSource], I.[SalesSource]) AS [SalesSource],
		ISNULL(S.[SalesTerritoryID], I.[SalesTerritoryID]) AS [SalesTerritoryID],
		ISNULL(S.[SalesOrderUnitPrice], I.[SalesOrderUnitPrice]) AS [SOUnitPrice],
		ISNULL(S.[OrderStatus], I.[OrderStatus]) AS [OrderStatus],
		ISNULL(S.[ShipDate], I.[ShipDate]) AS [ShipDate],
		ISNULL(S.[QtyShipped], I.[QtyShipped]) AS [ItemsShipped],
		ISNULL(S.[ItemQty], I.[ItemQty]) AS [QtyShipped],
		ISNULL(S.[TranID], I.[TranID]) AS [TranID],
		ISNULL(S.[TranType], I.[TranType]) AS [TranType]
	FROM 
	(
		SELECT 
			[SalesOrder],
			[ItemID],
			[WhseID],
			IIF([ItemID] IN ('RFIT-ASY-0001','RFIT-ASY-0096','RFIT-ASY-0105','RFIT-ASY-0107','RFIT-ASY-0120','RFIT-ASY-0124','RFIT-ASY-0125','NI-RFIT-ASY-0001','NI-RFIT-ASY-0096','NI-RFIT-ASY-0105','NI-RFIT-ASY-0107',
							 'NI-RFIT-ASY-0124','NI-RFIT-ASY-0125','NI-RFIT-ASY-0093','RFIT-ASY-0115'), 'RP',
				IIF([ItemID] IN ('RFIT-ASY-0118','RFIT-ASY-0119','NI-RFIT-ASY-0118','NI-RFIT-ASY-0119'), 'ME', 
				IIF([ItemID] IN ('RFIT-ASY-0094','RFIT-ASY-0122','RFIT-ASY-0002','NI-RFIT-ASY-0002','NI-RFIT-ASY-0094'), 'BT',
				IIF([ItemID] IN ('RFIT-ASY-0104','RFIT-ASY-0116','RFIT-ASY-0008','NI-RFIT-ASY-0104','NI-RFIT-ASY-0116','NI-RFIT-ASY-0008'), 'GI',
				IIF([ItemID] IN ('RFIT-ASY-0109','RFIT-ASY-0114','RFIT-ASY-0126','RFIT-ASY-0127','RFIT-ASY-0007','NI-RFIT-ASY-0109','NI-RFIT-ASY-0114','NI-RFIT-ASY-0126','NI-RFIT-ASY-0127','NI-RFIT-ASY-0007'), 'BCID',
				IIF([ItemID] LIKE 'FLM1-ASY-0001%', 'FA1.5',
				IIF([ItemID] LIKE 'FLM2-ASY-0001%', 'FA2.0',
				IIF([ItemID] LIKE 'HTFA-%', 'Torch','Other')))))))) AS [ProductType],
			[CustID],
			[CurrentCustClassID],
			[ShipToAddrStateID],
			[ShipToCountryID],
			[SalesSource],
			[SalesTerritoryID],
			[SalesOrderUnitPrice],
			[OrderStatus],
			[ShipDate],
			[QtyShipped],
			IIF([ItemID] IN ('RFIT-ASY-0001','RFIT-ASY-0018','RFIT-ASY-0105','RFIT-ASY-0114','RFIT-ASY-0116','RFIT-ASY-0118','RFIT-ASY-0120','RFIT-ASY-0124','RFIT-ASY-0126','RFIT-ASY-0002','RFIT-ASY-0007',
							 'RFIT-ASY-0008','RFIT-ASY-0015','RFIT-ASY-0092','RFIT-ASY-0097','RFIT-ASY-0098','RFIT-ASY-0100','RFIT-ASY-0108','RFIT-ASY-0111','RFIT-ASY-0112',
							 'RFIT-ASY-0118','NI-RFIT-ASY-0001','NI-RFIT-ASY-0002',	'NI-RFIT-ASY-0105',	'NI-RFIT-ASY-0114','NI-RFIT-ASY-0116','NI-RFIT-ASY-0118','NI-RFIT-ASY-0124','NI-RFIT-ASY-0126','NI-RFIT-ASY-0127'), 
				[QtyShipped]*30, 
				IIF([ItemID] IN ('RFIT-ASY-0090','RFIT-ASY-0091','RFIT-ASY-0098','FLM1-ASY-0001','FLM1-ASY-0001R','FLM2-ASY-0001','FLM2-ASY-0001R'), [QtyShipped], [QtyShipped]*6)) AS [ItemQty],
			[TranID],
			[TranType]
		FROM [SQL1-RO].[mas500_app].[dbo].[vdvShipmentLine] WITH(NOLOCK)
		WHERE [ItemID] IN
		(
			'RFIT-ASY-0001',	
			'RFIT-ASY-0094',	
			'RFIT-ASY-0096',	
			'RFIT-ASY-0104',	
			'RFIT-ASY-0105',	
			'RFIT-ASY-0107',	
			'RFIT-ASY-0109',	
			'RFIT-ASY-0114',	
			'RFIT-ASY-0116',	
			'RFIT-ASY-0118',	
			'RFIT-ASY-0119',	
			'RFIT-ASY-0120',	
			'RFIT-ASY-0122',	
			'RFIT-ASY-0124',	
			'RFIT-ASY-0125',	
			'RFIT-ASY-0126',	
			'RFIT-ASY-0127',	
			'RFIT-ASY-0100',	
			'NI-RFIT-ASY-0001',	
			'NI-RFIT-ASY-0096',	
			'NI-RFIT-ASY-0104',	
			'NI-RFIT-ASY-0105',	
			'NI-RFIT-ASY-0107',	
			'NI-RFIT-ASY-0109',	
			'NI-RFIT-ASY-0114',	
			'NI-RFIT-ASY-0116',	
			'NI-RFIT-ASY-0118',	
			'NI-RFIT-ASY-0119',	
			'NI-RFIT-ASY-0124',	
			'NI-RFIT-ASY-0125',	
			'NI-RFIT-ASY-0126',	
			'NI-RFIT-ASY-0127', 
			'FLM1-ASY-0001',
			'FLM2-ASY-0001',
			'FLM1-ASY-0001R',
			'FLM2-ASY-0001R',
			'HTFA-ASY-0003',
			'FLM1-ASY-0121',
			'FLM1-ASY-0122',
			'FLM1-ASY-0123',
			'FLM1-ASY-0124',
			'FLM1-ASY-0129',
			'FLM1-ASY-0130'
		) 
	) S FULL OUTER JOIN
	(
		SELECT 
			NULL AS [SalesOrder],
			[ItemID],
			[WhseID],
			IIF([ItemID] IN ('RFIT-ASY-0001','RFIT-ASY-0096','RFIT-ASY-0105','RFIT-ASY-0107','RFIT-ASY-0120','RFIT-ASY-0124','RFIT-ASY-0125','NI-RFIT-ASY-0001','NI-RFIT-ASY-0096','NI-RFIT-ASY-0105','NI-RFIT-ASY-0107',
							 'NI-RFIT-ASY-0124','NI-RFIT-ASY-0125','NI-RFIT-ASY-0093','RFIT-ASY-0115'), 'RP',
				IIF([ItemID] IN ('RFIT-ASY-0118','RFIT-ASY-0119','NI-RFIT-ASY-0118','NI-RFIT-ASY-0119'), 'ME', 
				IIF([ItemID] IN ('RFIT-ASY-0094','RFIT-ASY-0122','RFIT-ASY-0002','NI-RFIT-ASY-0002','NI-RFIT-ASY-0094'), 'BT',
				IIF([ItemID] IN ('RFIT-ASY-0104','RFIT-ASY-0116','RFIT-ASY-0008','NI-RFIT-ASY-0104','NI-RFIT-ASY-0116','NI-RFIT-ASY-0008'), 'GI',
				IIF([ItemID] IN ('RFIT-ASY-0109','RFIT-ASY-0114','RFIT-ASY-0126','RFIT-ASY-0127','RFIT-ASY-0007','NI-RFIT-ASY-0109','NI-RFIT-ASY-0114','NI-RFIT-ASY-0126','NI-RFIT-ASY-0127','NI-RFIT-ASY-0007'), 'BCID',
				IIF([ItemID] LIKE 'FLM1-ASY-0001%', 'FA1.5',
				IIF([ItemID] LIKE 'FLM2-ASY-0001%', 'FA2.0',
				IIF([ItemID] LIKE 'HTFA-%', 'Torch','Other')))))))) AS [ProductType],
			NULL AS [CustID],
			NULL AS [CurrentCustClassID],
			NULL AS [ShipToAddrStateID],
			NULL AS [ShipToCountryID],
			NULL AS [SalesSource],
			NULL AS [SalesTerritoryID],
			NULL AS [SalesOrderUnitPrice],
			NULL AS [OrderStatus],
			[TranDate] AS [ShipDate],
			[TranQty] AS [QtyShipped],
			IIF([ItemID] IN ('RFIT-ASY-0001','RFIT-ASY-0018','RFIT-ASY-0105','RFIT-ASY-0114','RFIT-ASY-0116','RFIT-ASY-0118','RFIT-ASY-0120','RFIT-ASY-0124','RFIT-ASY-0126','RFIT-ASY-0002','RFIT-ASY-0007',
							 'RFIT-ASY-0008','RFIT-ASY-0015','RFIT-ASY-0092','RFIT-ASY-0097','RFIT-ASY-0098','RFIT-ASY-0100','RFIT-ASY-0108','RFIT-ASY-0111','RFIT-ASY-0112',
							 'RFIT-ASY-0118','NI-RFIT-ASY-0001','NI-RFIT-ASY-0002',	'NI-RFIT-ASY-0105',	'NI-RFIT-ASY-0114','NI-RFIT-ASY-0116','NI-RFIT-ASY-0118','NI-RFIT-ASY-0124','NI-RFIT-ASY-0126','NI-RFIT-ASY-0127'), 
				[TranQty]*30, 
				IIF([ItemID] IN ('RFIT-ASY-0090','RFIT-ASY-0091','RFIT-ASY-0098','FLM1-ASY-0001','FLM1-ASY-0001R','FLM2-ASY-0001','FLM2-ASY-0001R'), [TranQty], [TranQty]*6)) AS [ItemQty],
			[TranID],
			[TranType]
		FROM [SQL1-RO].[mas500_app].[dbo].[vdvInventoryTran] WITH(NOLOCK)
		WHERE [ItemID] IN
		(
			'RFIT-ASY-0001',	
			'RFIT-ASY-0094',	
			'RFIT-ASY-0096',
			'RFIT-ASY-0104',	
			'RFIT-ASY-0105',	
			'RFIT-ASY-0107',	
			'RFIT-ASY-0109',	
			'RFIT-ASY-0114',	
			'RFIT-ASY-0116',	
			'RFIT-ASY-0118',	
			'RFIT-ASY-0119',	
			'RFIT-ASY-0120',	
			'RFIT-ASY-0122',	
			'RFIT-ASY-0124',	
			'RFIT-ASY-0125',	
			'RFIT-ASY-0126',	
			'RFIT-ASY-0127',				
			'RFIT-ASY-0100',				
			'NI-RFIT-ASY-0001',	
			'NI-RFIT-ASY-0096',	
			'NI-RFIT-ASY-0104',	
			'NI-RFIT-ASY-0105',	
			'NI-RFIT-ASY-0107',	
			'NI-RFIT-ASY-0109',	
			'NI-RFIT-ASY-0114',	
			'NI-RFIT-ASY-0116',	
			'NI-RFIT-ASY-0118',	
			'NI-RFIT-ASY-0119',	
			'NI-RFIT-ASY-0124',	
			'NI-RFIT-ASY-0125',	
			'NI-RFIT-ASY-0126',	
			'NI-RFIT-ASY-0127', 
			'FLM1-ASY-0001',
			'FLM2-ASY-0001',
			'FLM1-ASY-0001R',
			'FLM2-ASY-0001R',
			'HTFA-ASY-0003',
			'FLM1-ASY-0121',
			'FLM1-ASY-0122',
			'FLM1-ASY-0123',
			'FLM1-ASY-0124',
			'FLM1-ASY-0129',
			'FLM1-ASY-0130'
		) AND [WhseID] IN ('STOCK','RFSTK','STOCK2','FFSTK') AND [TranType] IN ('IS','SA')
	) I
		ON S.[TranID] = I.[TranID]
	WHERE S.[ShipDate] > GETDATE() - 90 OR I.[ShipDate] > GETDATE() - 90
) D
ORDER BY [ShipDate], [SalesOrder]